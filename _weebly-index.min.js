"use strict";var ip;function checkForm(){let ins=["fname","lname","id","pass"];if(!byID("input")||ins.some(val=>!byID(val)))return err("Internal Error! Reloading..."),window.location.reload(!0),!1;for(let x of ins)byID(x).focus();return byID(ins[ins.length-2]).blur(),byID("input").checkValidity()?parseInt(byID("id").value)%13==11||(byID("id").focus(),err("You may have mistyped your student ID. Please double check."),!1):(err("Invalid Input"),!1)}function submitData(fn,load,ins,attempt,restart){let data;xhr(fn,load,()=>{switch(attempt){case 0:war("Connection to Crappy Server Timed Out, 1st Retry...");break;case 1:war("Connection to Crappy Server Timed Out, 2nd Retry...");break;default:return void err("Connection to Crappy Server Timed Out!")}restart(attempt+1)},!0,ins.reduce((acc,cur)=>(acc[cur]=byID(cur).value.trim().toLowerCase(),acc),{}))}function xhr(path,load,timeout,method,data={}){let xhr=new XMLHttpRequest;xhr.timeout=1e4,xhr.addEventListener("timeout",timeout),xhr.addEventListener("load",()=>load(xhr)),method?(xhr.open("POST",path),xhr.responseType="json",xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(Object.entries(data).map(([k,v])=>encodeURIComponent(k)+"="+encodeURIComponent(v)).join("&"))):(xhr.open("GET",path),xhr.send())}function putInStat(text,color){let stat=byID("stat");stat.style.color=color,stat.value=text}let byID=e=>document.getElementById(e),suc=text=>putInStat(text,"#1b5e20"),war=text=>putInStat(text,"#f57f17"),err=text=>putInStat(text,"#d50000"),errCon=()=>err("Connection to Crappy Server Timed Out!");function search(attempt=0){let ins=["fname","lname","id","pass"],outs=["serv","lead","fell"];for(let x of outs)byID(x).value="";if(checkForm()){if(!attempt){war("Searching Data on Crappy Server...");for(let x of outs)byID(x).value="Checking..."}submitData(`http://${ip}/php/search.php`,x=>{if(200===x.status){for(let y of outs)byID(y).value="";switch(x.response.stat){case 1:return void err("Name-ID Combination not Found!");case-2:return void err("Request Error!");case-3:return void err("Server is Updating Data, Please Retry in a Few Moments...");case 0:for(let y of outs)byID(y).value=(Math.round(100*parseFloat(x.response[y]))/100).toFixed(2);return void suc("Success");default:err(x.response.data)}}err("Internal Error!")},ins,attempt,search)}}let time=()=>xhr(`http://${ip}/php/search.php`,x=>{if(200==x.status){suc("Data Fetched at "+x.responseText);for(let x of["submit","fname","lname","id","pass"])byID(x).disabled=!1}else errCon()},errCon,!1);document.addEventListener("DOMContentLoaded",()=>{let p=["  ___________  ____   ___    _______ ______"," / ___/ __/ / / / /  / _ )  / ___/ //_/  _/","/ /___\\ \\/ /_/ / /__/ _  | / /__/ ,< _/ /","\\___/___/\\____/____/____/  \\___/_/|_/___/",""," Bug Reports Welcomed!"];console.log(p.join("\n")),war("Testing Connection with Crappy Server..."),xhr("https://mushinako.github.io/Check-Hours/ip.txt",x=>{200===x.status?(ip=x.responseText.trim()+":38080",time(),byID("submit").addEventListener("click",e=>{e.preventDefault(),search()}),document.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),search())}),byID("fname").focus()):errCon()},errCon,!1)});